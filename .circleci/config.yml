version: 2.1

# -------------------------------------------------------------------------------------------------
# ORBS
# -------------------------------------------------------------------------------------------------

orbs:
  frontend: ornikar/frontend-orb@9.10.0

# -------------------------------------------------------------------------------------------------
# WORKFLOWS
# -------------------------------------------------------------------------------------------------

workflows:
  version: 2

  main-workflow:
    jobs:
      - frontend/checks:
          name: checks
          check-package-script-path: 'scripts/check-packagejson.mjs'

      - frontend/lint-src:
          name: lint
          use-cache: false
          cache-version: none
          run-tsc: false

      # prerelease
      - hold-prerelease:
          type: approval
          filters:
            branches:
              ignore: main

      - frontend/monorepo-release:
          name: prerelease
          context: npm-publish
          npm-publish: true
          no-private: true
          branch-release: true
          exact: true
          requires:
            - checks
            - lint
            - hold-prerelease
          filters:
            branches:
              ignore: main

      # release
      - hold-release:
          type: approval
          filters:
            branches:
              only: main

      - frontend/monorepo-release:
          context: npm-publish
          npm-publish: true
          no-private: true
          exact: true
          requires:
            - checks
            - lint
            - hold-release
          filters:
            branches:
              only: main
