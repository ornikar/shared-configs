version: 2.1

# -------------------------------------------------------------------------------------------------
# ORBS
# -------------------------------------------------------------------------------------------------

orbs:
  frontend: ornikar/frontend-orb@dev:d6d39b3

# -------------------------------------------------------------------------------------------------
# WORKFLOWS
# -------------------------------------------------------------------------------------------------

workflows:
  version: 2

  main-workflow:
    jobs:
      - frontend/checks:
          name: checks
          check-package-script-path: 'scripts/check-packagejson.mjs'

      - frontend/lint-src:
          name: lint
          use-cache: false
          cache-version: none
          run-tsc: false

      # release
      - hold-release:
          type: approval
          filters:
            branches:
              only:
                - main
                - /^main-.*/

      - frontend/monorepo-release:
          context: npm-publish
          npm-publish: true
          no-private: true
          requires:
            - checks
            - lint
            - hold-release
          filters:
            branches:
              only: main

      - frontend/monorepo-release:
          name: release-main-branch
          context: npm-publish
          npm-publish: true
          no-private: true
          branch-release: true
          branch-release-name: '${CIRCLE_BRANCH:5}'
          requires:
            - checks
            - lint
            - hold-release
          filters:
            branches:
              only: /^main-.*/
