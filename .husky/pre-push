#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

# This file is autogenerated by @ornikar/repo-config. Do not change it.

# get current branch name
currentBranch=$(git rev-parse --abbrev-ref HEAD)

# get current branch ref
branch_ref=$(git symbolic-ref HEAD)

# autodetect main branch (usually master or main)
mainBranch=$(LANG=en_US git remote show origin | grep "HEAD branch" | cut -d' ' -f5)

# z40 is the value matching the empty blob/commit/tree SHA (zero x 40)
z40=0000000000000000000000000000000000000000

while read local_ref local_sha remote_ref remote_sha
do
  if [[ "$local_ref" == "$branch_ref" ]]
  then
    if [[ "$remote_sha" != $z40 && "$remote_ref" == "refs/heads/$mainBranch" ]]
    then
      echo "Do not push directly on \"origin/$currentBranch\""
      exit 1
    fi
    CI=true yarn test --changedSince=origin/$mainBranch
  fi
done
